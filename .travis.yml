language: rust
sudo: true
rust:
    - nightly
    - beta
after_success: |
  cargo clean;
  cargo test --no-run;
  sudo apt-get update &&
  sudo apt-get install libcurl4-openssl-dev libelf-dev libdw-dev binutils-dev &&
  wget https://github.com/SimonKagstrom/kcov/archive/master.tar.gz &&
  tar xzf master.tar.gz &&
  mkdir kcov-master/build &&
  cd kcov-master/build &&
  cmake .. &&
  make &&
  sudo make install &&
  cd ../.. &&
  kcov --exclude-pattern=/.cargo target/kcov_a target/debug/stream-* &&
  kcov --exclude-pattern=/.cargo target/kcov_b target/debug/utp-* &&
  kcov --coveralls-id=$TRAVIS_JOB_ID --merge target/kcov target/kcov_a target/kcov_b
